<!DOCTYPE html>
<html>
<head>
    <title>Zeiterfassung - Check In/Out</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    {% include 'menu.html' %}
    <div class="container">
        <h1>Zeiterfassungssystem</h1>
        
        <!-- Flash messages moved here, before the form -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {% if category == 'error' %}error{% else %}success{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <!-- Form starts after flash messages -->
        <div id="attendance-forms">
            <div>
                <select id="user-selector" required>
                    <option value="" disabled selected>WÃ¤hle Benutzer</option>
                    {% for user in users %}q
                        <option value="{{ user[0] }}">{{ user[1] }}</option>
                    {% endfor %}
                </select>
            </div>
            <div style="display:flex; gap:1em; justify-content:center; margin-top: 10px;">
                <form action="/checkin" method="post" class="inline-form">
                    <input type="hidden" name="user_id" id="checkin-user-id">
                    <button type="submit" id="checkin-btn" disabled>Check In</button>
                </form>
                <form action="/checkout" method="post" class="inline-form">
                    <input type="hidden" name="user_id" id="checkout-user-id">
                    <button type="submit" id="checkout-btn" disabled>Check Out</button>
                </form>
            </div>
        </div>
    </div>
    <style>
        .inline-form {
            display: inline-block;
        }
    </style>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const userSelector = document.getElementById('user-selector');
        const checkinUserIdField = document.getElementById('checkin-user-id');
        const checkoutUserIdField = document.getElementById('checkout-user-id');
        const checkinBtn = document.getElementById('checkin-btn');
        const checkoutBtn = document.getElementById('checkout-btn');
        
        userSelector.addEventListener('change', function() {
            const selectedUserId = this.value;
            if (selectedUserId) {
                checkinUserIdField.value = selectedUserId;
                checkoutUserIdField.value = selectedUserId;
                checkinBtn.disabled = false;
                checkoutBtn.disabled = false;
            } else {
                checkinBtn.disabled = true;
                checkoutBtn.disabled = true;
            }
        });
    });
    </script>
</body>
</html>
