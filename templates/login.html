<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    {% include 'head_includes.html' %}

</head>
<body class="login-page">
    {% include 'menu.html' %}
    <div class="login-card">
        <h1><i class="fas fa-sign-in-alt icon-inline"></i>Login</h1>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {% if category == 'error' %}error{% else %}success{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <form method="post" class="login-form">
            <input type="text" name="username" placeholder="Benutzername" autocomplete="username" required>
            <input type="password" name="password" id="password-input" placeholder="Passwort" autocomplete="current-password" required>
            <label class="show-password"><input type="checkbox" id="show-password-toggle"> Passwort anzeigen</label>
            <button type="submit"><i class="fas fa-sign-in-alt"></i> Login</button>
        </form>
        <a href="/" class="back-link"><i class="fas fa-arrow-left"></i> Zur√ºck zur Startseite</a>
    </div>
    {% if 'user_id' in session %}
    <script>
        sessionStorage.setItem('user_id', '{{ session.user_id }}');
    </script>
    {% else %}
    <script>
        sessionStorage.removeItem('user_id');
    </script>
    {% endif %}
    <script>
    document.getElementById('show-password-toggle').addEventListener('change', function() {
        var pwd = document.getElementById('password-input');
        pwd.type = this.checked ? 'text' : 'password';
    });
    </script>
    <script src="/static/script.js"></script>
    <script>
        // Modern login page enhancements
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('password-input');
            const showPasswordToggle = document.getElementById('show-password-toggle');
            const loginForm = document.querySelector('.login-form');
            const submitButton = loginForm.querySelector('button[type="submit"]');
            const inputs = loginForm.querySelectorAll('input[type="text"], input[type="password"]');
            
            // Enhanced show/hide password functionality
            if (showPasswordToggle && passwordInput) {
                showPasswordToggle.addEventListener('change', function() {
                    passwordInput.type = this.checked ? 'text' : 'password';
                    
                    // Add smooth transition effect
                    passwordInput.style.transition = 'all 0.3s ease';
                    passwordInput.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        passwordInput.style.transform = 'scale(1)';
                    }, 150);
                });
            }
            
            // Enhanced floating label animation for inputs
            inputs.forEach(input => {
                const label = document.createElement('label');
                label.textContent = input.getAttribute('placeholder') || input.name;
                label.style.cssText = `
                    position: absolute;
                    left: 16px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: #f8fafc;
                    padding: 0 8px;
                    color: #94a3b8;
                    pointer-events: none;
                    transition: all 0.3s ease;
                    font-size: 14px;
                    z-index: 1;
                `;
                
                // Wrap input in container for positioning
                const container = document.createElement('div');
                container.style.position = 'relative';
                input.parentNode.insertBefore(container, input);
                container.appendChild(input);
                container.appendChild(label);
                
                // Handle focus/blur events
                const updateLabel = () => {
                    if (input.value || input === document.activeElement) {
                        label.style.top = '0';
                        label.style.transform = 'translateY(-50%) scale(0.85)';
                        label.style.color = '#667eea';
                        label.style.background = '#ffffff';
                    } else {
                        label.style.top = '50%';
                        label.style.transform = 'translateY(-50%)';
                        label.style.color = '#94a3b8';
                        label.style.background = '#f8fafc';
                    }
                };
                
                input.addEventListener('focus', updateLabel);
                input.addEventListener('blur', updateLabel);
                input.addEventListener('input', updateLabel);
                
                // Initial check
                updateLabel();
            });
            
            // Add form submission animation
            loginForm.addEventListener('submit', function(e) {
                submitButton.classList.add('loading');
                submitButton.style.pointerEvents = 'none';
                
                // Reset after 3 seconds if still loading (fallback)
                setTimeout(() => {
                    submitButton.classList.remove('loading');
                    submitButton.style.pointerEvents = 'auto';
                }, 3000);
            });
            
            // Add ripple effect to button
            submitButton.addEventListener('click', function(e) {
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.cssText = `
                    position: absolute;
                    left: ${x}px;
                    top: ${y}px;
                    width: ${size}px;
                    height: ${size}px;
                    background: rgba(255, 255, 255, 0.3);
                    border-radius: 50%;
                    transform: scale(0);
                    animation: ripple 0.6s ease-out;
                    pointer-events: none;
                `;
                
                this.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
            
            // Add CSS for ripple animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes ripple {
                    to {
                        transform: scale(4);
                        opacity: 0;
                    }
                }
                
                .login-form button {
                    position: relative;
                    overflow: hidden;
                }
            `;
            document.head.appendChild(style);
            
            // Add entrance animation
            const loginCard = document.querySelector('.login-card');
            loginCard.style.opacity = '0';
            loginCard.style.transform = 'translateY(30px) scale(0.95)';
            
            setTimeout(() => {
                loginCard.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                loginCard.style.opacity = '1';
                loginCard.style.transform = 'translateY(0) scale(1)';
            }, 100);
        });
        </script>
</body>
</html>
